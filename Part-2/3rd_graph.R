#Chosse file PedFluDeath_WeeklyData.csv
#please clear the previous environment variables before running
data2<-read.csv(file.choose())
colnames(data2)[colnames(data2)=="WEEK.NUMBER"]<-"Week.of.Death"
colnames(data2)[colnames(data2)=="CURRENT.WEEK.DEATHS"]<-"Deaths.Reported.Current.Week"
colnames(data2)[colnames(data2)=="PREVIOUS.WEEKS.DEATHS"]<-"Deaths.Reported.Previous.Week"

library(ggplot2)
library(dplyr)
library(reshape2)
keeps<-c("Week.of.Death","Deaths.Reported.Current.Week","Deaths.Reported.Previous.Week")
data_subset<-data2[keeps]
mdfr<-melt(data_subset,id.vars="Week.of.Death")
mdfr$Week.of.Death<-as.character(mdfr$Week.of.Death)
p<-ggplot(mdfr,aes(x=Week.of.Death,y=value,fill=variable))+geom_histogram(stat="identity",color="black")
p<-p+scale_fill_manual(values=c("skyblue","green"))


p<-p+scale_x_discrete(limits=c("2014-40",	"2014-41",	"2014-42",	"2014-43",	"2014-44",	"2014-45",	"2014-46",	"2014-47",	"2014-48",	"2014-49",	"2014-50",	"2014-51",	"2014-52",	"2014-53",	"2015-01",	"2015-02",	"2015-03",	"2015-04",	"2015-05",	"2015-06",	"2015-07",	"2015-08",	"2015-09",	"2015-10",	"2015-11",	"2015-12",	"2015-13",	"2015-14",	"2015-15",	"2015-16",	"2015-17",	"2015-18",	"2015-19",	"2015-20",	"2015-21",	"2015-22",	"2015-23",	"2015-24",	"2015-25",	"2015-26",	"2015-27",	"2015-28",	"2015-29",	"2015-30",	"2015-31",	"2015-32",	"2015-33",	"2015-34",	"2015-35",	"2015-36",	"2015-37",	"2015-38",	"2015-39",	"2015-40",	"2015-41",	"2015-42",	"2015-43",	"2015-44",	"2015-45",	"2015-46",	"2015-47",	"2015-48",	"2015-49",	"2015-50",	"2015-51",	"2015-52",	"2016-01",	"2016-02",	"2016-03",	"2016-04",	"2016-05",	"2016-06",	"2016-07",	"2016-08",	"2016-09",	"2016-10",	"2016-11",	"2016-12",	"2016-13",	"2016-14",	"2016-15",	"2016-16",	"2016-17",	"2016-18",	"2016-19",	"2016-20",	"2016-21",	"2016-22",	"2016-23",	"2016-24",	"2016-25",	"2016-26",	"2016-27",	"2016-28",	"2016-29",	"2016-30",	"2016-31",	"2016-32",	"2016-33",	"2016-34",	"2016-35",	"2016-36",	"2016-37",	"2016-38",	"2016-39",	"2016-40",	"2016-41",	"2016-42",	"2016-43",	"2016-44",	"2016-45",	"2016-46",	"2016-47",	"2016-48",	"2016-49",	"2016-50",	"2016-51",	"2016-52",	"2017-01",	"2017-02",	"2017-03",	"2017-04",	"2017-05",	"2017-06",	"2017-07",	"2017-08",	"2017-09",	"2017-10",	"2017-11",	"2017-12",	"2017-13",	"2017-14",	"2017-15",	"2017-16",	"2017-17",	"2017-18",	"2017-19",	"2017-20",	"2017-21",	"2017-22",	"2017-23",	"2017-24",	"2017-25",	"2017-26",	"2017-27",	"2017-28",	"2017-29",	"2017-30",	"2017-31",	"2017-32",	"2017-33",	"2017-34",	"2017-35",	"2017-36",	"2017-37",	"2017-38",	"2017-39",	"2017-40",	"2017-41",	"2017-42",	"2017-43",	"2017-44",	"2017-45",	"2017-46",	"2017-47",	"2017-48",	"2017-49",	"2017-50",	"2017-51",	"2017-52",	"2018-01",	"2018-02",	"2018-03",	"2018-04"),labels=c("2014-40",	" ",	" ",	" ",	" ",	" ",	"2014-46",	" ",	" ",	" ",	" ",	" ",	"2014-52",	" ",	" ",	" ",	" ",	" ",	"2015-05",	" ",	" ",	" ",	" ",	" ",	"2015-11",	" ",	" ",	" ",	" ",	" ",	"2015-17",	" ",	" ",	" ",	" ",	" ",	"2015-23",	" ",	" ",	" ",	" ",	" ",	"2015-29",	" ",	" ",	" ",	" ",	" ",	"2015-35",	" ",	" ",	" ",	" ",	" ",	"2015-41",	" ",	" ",	" ",	" ",	" ",	"2015-47",	" ",	" ",	" ",	" ",	" ",	"2016-01",	" ",	" ",	" ",	" ",	" ",	"2016-07",	" ",	" ",	" ",	" ",	" ",	"2016-13",	" ",	" ",	" ",	" ",	" ",	"2016-19",	" ",	" ",	" ",	" ",	" ",	"2016-25",	" ",	" ",	" ",	" ",	" ",	"2016-31",	" ",	" ",	" ",	" ",	" ",	"2016-37",	" ",	" ",	" ",	" ",	" ",	"2016-43",	" ",	" ",	" ",	" ",	" ",	"2016-49",	" ",	" ",	" ",	" ",	" ",	"2017-03",	" ",	" ",	" ",	" ",	" ",	"2017-09",	" ",	" ",	" ",	" ",	" ",	"2017-15",	" ",	" ",	" ",	" ",	" ",	"2017-21",	" ",	" ",	" ",	" ",	" ",	"2017-27",	" ",	" ",	" ",	" ",	" ",	"2017-33",	" ",	" ",	" ",	" ",	" ",	"2017-39",	" ",	" ",	" ",	" ",	" ",	"2017-45",	" ",	" ",	" ",	" ",	" ",	"2017-51",	" ",	" ",	" ",	" ",	" "),expand = c(0, 0))

p<-p+ scale_y_continuous(breaks=seq(0,30,5),expand = c(0, 0))
p<-p+theme(axis.text.x = element_text(angle=90, hjust=1))

p<-p+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
p<-p +theme(legend.position="bottom")
p<-p+guides(fill=guide_legend(title=NULL))
p<-p+guides(fill=guide_legend(title=NULL,keywidth =0.5, keyheight = 0.5))
p<-p+ylab("Number of deaths")
p<-p+annotate("text",x="2015-11",y=14,,label="2014-2015 \n Number of Deaths=148")
p<-p+annotate("text",x="2015-47",y=16,,label="2015-2016 \n Number of Deaths=93")
p<-p+annotate("text",x="2016-49",y=14,,label="2016-2017 \n Number of Deaths=110")
p<-p+annotate("text",x="2017-33",y=16,,label="2017-2018 \n Number of Deaths=53")

p<-p+ggtitle("              Number of Influenza-Associated Pediatric Deaths \n   by Week of Death: 2014-2015 season to Present")
plot(p)
ggsave("3rd_graph.pdf")